(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{1511:function(e,t,n){},1649:function(e,t,n){},1650:function(e,t,n){},1651:function(e,t,n){},1652:function(e,t,n){},1655:function(e,t,n){},1656:function(e,t,n){},1702:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(65),c=n(32),i=n(539),l=n(42),s=n(6),u=n(1),m=n(8),f=n(1421),p=n.n(f),d=n(78),h=n.n(d),g=n(10),y=n(11),v=n(2),b=n(47),E=n.n(b),_=n(1649);function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function e(t){return typeof t}:function e(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function N(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(e,t,n){return t&&O(e.prototype,t),n&&O(e,n),e}function S(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}function j(e,t){return(j=Object.setPrototypeOf||function e(t,n){return t.__proto__=n,t})(e,t)}function C(e){var t=k();return function n(){var r=I(e),a;if(t){var o=I(this).constructor;a=Reflect.construct(r,arguments,o)}else a=r.apply(this,arguments);return P(this,a)}}function P(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?T(e):t}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)})(e)}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var x={RUNNING:"\u8fd0\u884c\u4e2d",PASS:"\u901a\u8fc7",FAIL:"\u4e0d\u901a\u8fc7",WARN:"\u6709\u544a\u8b66",NOT_RUN:"\u672a\u8fd0\u884c"},D={RUNNING:"loading",PASS:"tick-o-fill",FAIL:"remove-o-fill",WARN:"warning-o-fill",NOT_RUN:"remove-o-fill"},A={RUNNING:"#1B9AEE",PASS:"#1dc11d",FAIL:"red",WARN:"orange",NOT_RUN:"red"},M=u.Tag.Colorable,L="codescan-info",q=function(e){S(n,e);var t=C(n);function n(e){var r;return N(this,n),B(T(r=t.call(this,e)),"renderBuildTitle",(function(e){var t="",n="";return"RUNNING"===e.state?(t="blue",n="\u8fd0\u884c\u4e2d"):"PASS"===e.state?(t="green",n="\u901a\u8fc7"):"WARNING"===e.state?(t="orange",n="\u6709\u544a\u8b66"):"FAIL"===e.state?(t="red",n="\u4e0d\u901a\u8fc7"):"ERROR"===e.state?(t="red",n="\u8fd0\u884c\u5f02\u5e38"):"NOT_RUN"===e.state&&(t="gray",n="\u672a\u8fd0\u884c"),a.a.createElement("div",{className:"".concat(L,"-list-item-left")},a.a.createElement("span",{className:"tag-wrapper"},a.a.createElement(M,{color:t,className:"tag"},a.a.createElement("span",null,a.a.createElement(m.a,{type:"scan",biz:"code"})),a.a.createElement("span",{style:{paddingLeft:4}},n))),a.a.createElement("span",{className:"name"},e.task_name),r.isBuildInScan(e)&&"RUNNING"!==e.state?a.a.createElement("span",{className:"num"},"Blocker ",e.blocker_count," Critical ",e.critical_count," Major ",e.major_count):null)})),B(T(r),"goChangeTab",(function(e,t){var n=r.props,a=n.codeReviewDetail,o=n.issueDetailList,c=window.FORCE.pathResource;if("PASS"!==t){var i=o.find((function(t){return t.build_result_id===e}));if(i){var l="right";Object(y.d)("/".concat(c.fullPath,"/merge_request/").concat(a.id,"/changes#file=").concat(E()(i.file_name),"&line=").concat(i.begin_line,"&side=").concat(l))}else Object(y.d)("/".concat(c.fullPath,"/merge_request/").concat(a.id,"/changes"));r.props.openCodescanPanel({isShowCodeScan:!0,curBuildId:e})}else Object(y.d)("/".concat(c.fullPath,"/merge_request/").concat(a.id,"/changes"));r.props.changeMrTabKey("changes")})),B(T(r),"getStateBuildAndRate",(function(){var e=r.props.mergeRequestBuilds,t=e.filter((function(e){return"RUNNING"===e.state})),n=e.filter((function(e){return"FAIL"===e.state})),a=e.filter((function(e){return"PASS"===e.state})),o=e.filter((function(e){return"WARNING"===e.state})),c=e.filter((function(e){return"ERROR"===e.state})),i=e.filter((function(e){return"NOT_RUN"===e.state}));return{runningRate:(t.length/e.length*100).toFixed(2),failRate:(n.length/e.length*100).toFixed(2),passRate:(a.length/e.length*100).toFixed(2),warningRate:(o.length/e.length*100).toFixed(2),errorRate:(c.length/e.length*100).toFixed(2),notRunRate:(i.length/e.length*100).toFixed(2),runningBuilds:t,failBuilds:n,passBuilds:a,warningBuilds:o,errorBuilds:c,notRunBuilds:i}})),B(T(r),"isBuildInScan",(function(e){return v.a.buildInTaskNames.includes(e.enTaskName)})),B(T(r),"renderOverview",(function(){var e=r.props.mergeRequestBuilds,t=r.state.isShowCodeScan;if(!e.length)return null;var n=!1;e.forEach((function(e){"RUNNING"===e.state&&(n=!0)})),n||-1===r.intervalCnt||clearInterval(r.intervalCnt);var o=e.filter((function(e){return e.required&&"PASS"!==e.state}))||[],c=r.getStateBuildAndRate(),i=c.runningBuilds,l=c.failBuilds,s=c.errorBuilds,u=c.warningBuilds,f=c.passBuilds,p=c.notRunBuilds,d="",h="",g="",y="";"RUNNING"===(d=i.length?"RUNNING":l.length||s.length||p.length?"FAIL":u.length?"WARN":"PASS")?(h="\u81ea\u52a8\u5316\u68c0\u67e5".concat(x[d]),g=A[d],y=D[d]):"NOT_RUN"===d||"FAIL"===d&&0!==o.length?(h="\u5361\u70b9\u7684\u81ea\u52a8\u5316\u68c0\u67e5\u4e0d\u901a\u8fc7",g="#8c8c8c",y="clock-fill"):(h="\u5361\u70b9\u7684\u81ea\u52a8\u5316\u68c0\u67e5\u5168\u90e8\u901a\u8fc7",g="#1dc11d",y="tick-o-fill");var v=0;return i.length&&(v+=1),l.length&&(v+=1),f.length&&(v+=1),u.length&&(v+=1),s.length&&(v+=1),p.length&&(v+=1),v>3?a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{style:{flex:1}},a.a.createElement("div",{className:"".concat(L,"-title")},a.a.createElement(m.a,{type:y,style:{color:g}}),a.a.createElement("span",{className:"".concat(L,"-text")},h)),a.a.createElement("div",{className:"".concat(L,"-overview-left")},a.a.createElement("div",{className:"".concat(L,"-overview-info")},i.length?a.a.createElement("span",{className:"".concat(L,"-overview-info-item")},a.a.createElement("span",{className:"running-dot dot"}),a.a.createElement("span",{className:"number"},i.length,"\xa0\u9879\u8fd0\u884c\u4e2d")):null,l.length?a.a.createElement("span",{className:"".concat(L,"-overview-info-item")},a.a.createElement("span",{className:"fail-dot dot"}),a.a.createElement("span",{className:"number"},l.length,"\xa0\u9879\u4e0d\u901a\u8fc7",0===o.length?"\uff08\u975e\u5361\u70b9\uff09":"")):null,f.length?a.a.createElement("span",{className:"".concat(L,"-overview-info-item")},a.a.createElement("span",{className:"pass-dot dot"}),a.a.createElement("span",{className:"number"},f.length,"\xa0\u9879\u901a\u8fc7")):null,u.length?a.a.createElement("span",{className:"".concat(L,"-overview-info-item")},a.a.createElement("span",{className:"warning-dot dot"}),a.a.createElement("span",{className:"number"},u.length,"\xa0\u9879\u6709\u544a\u8b66")):null,s.length?a.a.createElement("span",{className:"".concat(L,"-overview-info-item")},a.a.createElement("span",{className:"error-dot dot"}),a.a.createElement("span",{className:"number"},s.length,"\xa0\u9879\u8fd0\u884c\u5f02\u5e38")):null,p.length?a.a.createElement("span",{className:"".concat(L,"-overview-info-item")},a.a.createElement("span",{className:"not-run-dot dot"}),a.a.createElement("span",{className:"number"},p.length,"\u9879\u672a\u8fd0\u884c")):null))),a.a.createElement("div",{className:"".concat(L,"-overview-arrow")},a.a.createElement(m.a,{className:"code-scane-arrow",type:"chevron-".concat(t?"up":"right","-s")}))):a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"".concat(L,"-title")},a.a.createElement(m.a,{type:y,style:{color:g}}),a.a.createElement("span",{className:"".concat(L,"-text")},h)),a.a.createElement("div",{className:"".concat(L,"-overview-left")},a.a.createElement("div",{className:"".concat(L,"-overview-info")},i.length?a.a.createElement("span",{className:"".concat(L,"-overview-info-item")},a.a.createElement("span",{className:"running-dot dot"}),a.a.createElement("span",{className:"number"},i.length,"\xa0\u9879\u8fd0\u884c\u4e2d")):null,l.length?a.a.createElement("span",{className:"".concat(L,"-overview-info-item")},a.a.createElement("span",{className:"fail-dot dot"}),a.a.createElement("span",{className:"number"},l.length,"\xa0\u9879\u4e0d\u901a\u8fc7",0===o.length?"\uff08\u975e\u5361\u70b9\uff09":"")):null,f.length?a.a.createElement("span",{className:"".concat(L,"-overview-info-item")},a.a.createElement("span",{className:"pass-dot dot"}),a.a.createElement("span",{className:"number"},f.length,"\xa0\u9879\u901a\u8fc7")):null,u.length?a.a.createElement("span",{className:"".concat(L,"-overview-info-item")},a.a.createElement("span",{className:"warning-dot dot"}),a.a.createElement("span",{className:"number"},u.length,"\xa0\u9879\u6709\u544a\u8b66")):null,s.length?a.a.createElement("span",{className:"".concat(L,"-overview-info-item")},a.a.createElement("span",{className:"error-dot dot"}),a.a.createElement("span",{className:"number"},s.length,"\xa0\u9879\u8fd0\u884c\u5f02\u5e38")):null,p.length?a.a.createElement("span",{className:"".concat(L,"-overview-info-item")},a.a.createElement("span",{className:"not-run-dot dot"}),a.a.createElement("span",{className:"number"},p.length,"\u9879\u672a\u8fd0\u884c")):null),a.a.createElement("div",{className:"".concat(L,"-overview-arrow")},a.a.createElement(m.a,{className:"code-scane-arrow",type:"chevron-".concat(t?"up":"right","-s")}))))})),r.state={isShowCodeScan:!1},r.intervalCnt=-1,r}return R(n,[{key:"componentDidMount",value:function e(){var t=this,n=this.props.mergeRequestBuilds,r=!1;n.forEach((function(e){"RUNNING"===e.state&&(r=!0)})),r&&(this.intervalCnt=setInterval((function(){t.props.getBuilds()}),5e3))}},{key:"componentWillUnmount",value:function e(){clearInterval(this.intervalCnt)}},{key:"render",value:function e(){var t=this,n=this.props,r=n.mergeRequestBuilds,o=n.codeReviewDetail,c=this.state.isShowCodeScan;if(!r.length)return null;var i=!1;return r.forEach((function(e){"RUNNING"===e.state&&(i=!0)})),i||-1===this.intervalCnt||clearInterval(this.intervalCnt),a.a.createElement("div",{className:"".concat(L)},a.a.createElement("div",{className:"".concat(L,"-overview"),onClick:function e(){Object(s.b)({action:c?"hide_automated_inspection":"show_automated_inspection",page:"Repo-MR",type:"",control:"",mr_id:o.id}),t.setState({isShowCodeScan:!c})}},this.renderOverview()),a.a.createElement("div",{style:{display:c?"block":"none"},className:"".concat(L,"-list")},r.map((function(e){return a.a.createElement("div",{className:"".concat(L,"-list-item")},t.renderBuildTitle(e),a.a.createElement("div",{className:"".concat(L,"-list-item-right")},e.required&&a.a.createElement("div",{className:"required",style:{marginRight:t.isBuildInScan(e)&&"RUNNING"===e.state?96:40}},a.a.createElement(M,{color:"gray",className:"tag"},"\u5361\u70b9")),a.a.createElement("div",{style:{display:t.isBuildInScan(e)&&"RUNNING"===e.state?"none":"block"}},t.isBuildInScan(e)?a.a.createElement(u.Button,{type:"primary",text:!0,onClick:function n(){Object(s.b)({action:"goto_pipelinelog",page:"Repo-MR",mr_id:o.id}),t.goChangeTab(e.id,e.state)}},"\u67e5\u770b\u8be6\u60c5"):a.a.createElement(u.Button,{type:"primary",text:!0,component:"a",href:e.url,target:"_blank"},"\u67e5\u770b\u8be6\u60c5"))))}))))}}]),n}(a.a.Component),F=n(29),X=n(7),U=n(1650);function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function e(t){return typeof t}:function e(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function G(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function K(e,t,n){return t&&J(e.prototype,t),n&&J(e,n),e}function H(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}function z(e,t){return(z=Object.setPrototypeOf||function e(t,n){return t.__proto__=n,t})(e,t)}function V(e){var t=Y();return function n(){var r=$(e),a;if(t){var o=$(this).constructor;a=Reflect.construct(r,arguments,o)}else a=r.apply(this,arguments);return Z(this,a)}}function Z(e,t){return!t||"object"!==W(t)&&"function"!=typeof t?Q(e):t}function Q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function $(e){return($=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)})(e)}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var te=new h.a,ne="mr-request-info",re="discussion",ae=function(e){H(n,e);var t=V(n);function n(e){var r;return G(this,n),ee(Q(r=t.call(this,e)),"onDialogOpen",(function(){r.setState({isDialogVisible:!0})})),ee(Q(r),"onDialogClose",(function(){r.setState({isDialogVisible:!1})})),ee(Q(r),"goWebIde",(function(e,t){e.preventDefault();var n=window.FORCE.codeReviewDetail;Object(g.P)({filepath:t,branch:n.sourceBranch,commit:"",line:"",column:"",type:"conflict",merge_commit:n.targetBranch,mergerequestId:n.id}).then((function(e){window.open(e.endpoint)})).catch((function(e){console.error(e)}))})),ee(Q(r),"goChangeTab",(function(){var e=r.props.changesReducer,t=e.codeReviewDetail,n=e.allComments,a=void 0===n?[]:n,o=window.FORCE.pathResource,c,i=X.b.comments2Conversations(a).openConversations,l,s,u,m=i[0]&&i[0][0];m&&(l=m.path,s=m.line,u=m.side),l&&u&&s?Object(y.d)("/".concat(o.fullPath,"/merge_request/").concat(t.id,"/changes#file=").concat(E()(l),"&line=").concat(s,"&side=").concat(u)):Object(y.d)("/".concat(o.fullPath,"/merge_request/").concat(t.id,"/changes")),r.props.openCommentPanel({isShowComment:!0,curCommentStatus:"open"}),r.props.changeMrTabKey("changes")})),ee(Q(r),"renderRight",(function(e,t){if("approver_number"===e.check_type)return a.a.createElement("div",{className:"mr-request-list-item-right"},t?a.a.createElement(p.a,{dataSource:t}):null);if("discussion"===e.check_type){var n=r.props.changesReducer.allComments,o=void 0===n?[]:n,c,i=X.b.comments2Conversations(o).openConversations;return a.a.createElement("div",{className:"mr-request-list-item-right"},a.a.createElement("span",{className:"fail-dot dot"}),a.a.createElement("span",{className:"number"},i.length,"\xa0\u6761\u5f85\u89e3\u51b3"),a.a.createElement(u.Button,{type:"primary",className:"discuss-detail-btn",text:!0,onClick:function t(){r.goChangeTab(e.id,e.state)}},"\u67e5\u770b\u8be6\u60c5"))}return a.a.createElement("div",{className:"mr-request-list-item-right"},e.unsatisfied_items.length?a.a.createElement("span",{className:"text-grey"},"\uff08",e.unsatisfied_items.join(", "),"\uff09"):null)})),ee(Q(r),"getRequiredBuildsJSX",(function(){var e=r.props.mergeRequestBuilds,t;if(!(e.filter((function(e){return e.required}))||[]).length)return null;var n=e.filter((function(e){return e.required&&"PASS"!==e.state&&"WARNING"!==e.state}))||[];return a.a.createElement("div",{className:"mr-request-list-item"},a.a.createElement("div",null,a.a.createElement("span",{className:"mr-request-list-item-icon"},a.a.createElement(m.a,{type:n.length?"clock-fill":"tick-o-fill",style:{color:n.length?"#8c8c8c":"#1dc11d"}})),a.a.createElement("span",null,"\u9700\u8981\u5361\u70b9\u7684\u81ea\u52a8\u5316\u68c0\u67e5\u5168\u90e8\u901a\u8fc7")))})),ee(Q(r),"renderWebIdeBtn",(function(){var e=window.FORCE.pathResource.isArchive,t=r.props,n=t.codeReviewDetail,o=t.ipSetting;return o?o.ip_whitelist_enabled&&"all"===o.scope?a.a.createElement(u.Balloon.Tooltip,{align:"t",trigger:a.a.createElement(u.Button,{type:"normal",size:"small",disabled:!0,style:{marginRight:8}},"Web IDE \u89e3\u51b3")},"\u4f01\u4e1a\u5df2\u542f\u7528 IP \u767d\u540d\u5355\u4e25\u683c\u7ba1\u63a7\uff0c\u6682\u4e0d\u652f\u6301\u4f7f\u7528 Web IDE"):"false"===e?a.a.createElement(u.Button,{type:"normal",size:"small",component:"a",onClick:function e(t){Object(s.b)({action:"resolve_conflict_by_ide",page:"Repo-MR",mr_id:n.id}),r.goWebIde(t,"")},style:{marginRight:8}},"Web IDE \u89e3\u51b3"):null:null})),r.state={isDialogVisible:!1},r.intervalCnt=-1,r}return K(n,[{key:"conflictTipsDialogJsx",value:function e(){var t=this.props.codeReviewDetail;return a.a.createElement(u.Dialog,{visible:this.state.isDialogVisible,onClose:this.onDialogClose,footer:!1,title:"\u51b2\u7a81\u89e3\u51b3\u65b9\u6cd5\u53c2\u8003",style:{width:"500px"}},a.a.createElement("div",{style:{margin:"-14px 0"},dangerouslySetInnerHTML:{__html:"en_US"!==window.FORCE.locale?te.render("COMMIT"===t.source_type?"\u6e90\u5206\u652f\u4e3aCOMMIT\uff0c\u8bf7\u5728\u7ebf\u4e0b\u5408\u5e76":"\n\u6b65\u9aa41. fetch\u5e76\u5207\u6362\u5230\u6e90\u5206\u652f\n\n```\ngit fetch origin\n\ngit checkout -b ".concat(t.source_branch," origin/").concat(t.source_branch,"\n```\n\n\u6b65\u9aa42. \u5408\u5e76\u76ee\u6807\u5206\u652f\n\n```\ngit merge origin/").concat(t.target_branch,"\n```\n\n\u6b65\u9aa43. \u89e3\u51b3\u51b2\u7a81\u5e76push\n        ")):te.render("COMMIT"===t.source_type?"Source is COMMIT, please merge at local":"\nStep 1. Fetch and checkout source branch\n\n```\ngit fetch origin\n\ngit checkout -b ".concat(t.source_branch," origin/").concat(t.source_branch,"\n```\n\nStep 2. Merge target branch\n\n```\ngit merge origin/").concat(t.target_branch,"\n```\n\nStep 3. Resolve conflicts and push\n        "))}}))}},{key:"approveCheckResultListJsx",value:function e(){var t=this,n=this.props.codeReviewDetail,r=n.assignees,o=n.approve_check_result,c;if(!o)return null;r&&(c=r.filter((function(e){return"approved"!==e.status}))).forEach((function(e){e.avatar_url&&(e.avatarUrl=e.avatar_url)}));var i=o.satisfied_check_results,l=o.unsatisfied_check_results,s=i&&i.filter((function(e){return"code_scan"!==e.check_type})),u=l&&l.filter((function(e){return"code_scan"!==e.check_type}));return a.a.createElement("div",null,s&&s.map((function(e){return a.a.createElement("div",{className:"mr-request-list-item"},a.a.createElement("div",null,a.a.createElement("span",{className:"mr-request-list-item-icon"},a.a.createElement(m.a,{type:"tick-o-fill",style:{color:"#1dc11d"}})),a.a.createElement("span",null,e.check_name)),a.a.createElement("div",{className:"mr-request-list-item-right"},e.satisfied_items.length?a.a.createElement(p.a,{dataSource:e.satisfied_items.map((function(e){try{var t=JSON.parse(e);return t.avatarUrl=t.avatar_url,t}catch(t){return e}}))}):null))})),u&&u.map((function(e){return a.a.createElement("div",{className:"mr-request-list-item ".concat(e.check_type)},a.a.createElement("div",null,a.a.createElement("span",{className:"mr-request-list-item-icon"},a.a.createElement(m.a,{type:"clock-fill",style:{color:"#8c8c8c"}})),a.a.createElement("span",null,e.check_name)),t.renderRight(e,c))})))}},{key:"render",value:function e(){var t=this,n=window.FORCE.pathResource.isArchive,r=this.props,o=r.codeReviewDetail,c=r.sourceBranchExist,i=r.targetBranchExist;return"false"!==n||"true"!==c||"true"!==i?null:"accepted"===o.state&&"can_be_merged"===o.mergeStatus&&0===o.approve_check_result.unsatisfied_check_results.length?a.a.createElement("div",{className:"".concat("mr-request-info"," success"),"border-len":1,"data-step":"1","data-tip":"Hi\uff0c\u65b0\u7248\u5408\u5e76\u8bf7\u6c42\u89c6\u56fe\u4e0a\u7ebf\u5566<br />\u5728\u8fd9\u91cc\u53ef\u4ee5\u67e5\u770b\u5408\u5e76\u6761\u4ef6\u54e6\uff5e"},a.a.createElement("div",{className:"".concat("mr-request-info","-title")},a.a.createElement("div",{className:"".concat("mr-request-info","-img")},a.a.createElement("img",{alt:"\u5df2\u8fbe\u5230\u5408\u5e76\u8981\u6c42",className:"".concat("mr-request-info","-yundou"),src:"https://img.alicdn.com/tfs/TB1GlGtIKL2gK0jSZFmXXc7iXXa-372-294.png"})),a.a.createElement("div",{className:"".concat("mr-request-info","-tip")},"\u5df2\u8fbe\u5230\u5408\u5e76\u8981\u6c42\uff0c\u51c6\u5907\u5408\u5e76\u5427")),a.a.createElement("div",null,a.a.createElement(q,this.props))):a.a.createElement("div",{className:"".concat("mr-request-info"," error noborder"),"border-len":1,"data-step":"1","data-tip":"Hi\uff0c\u65b0\u7248\u5408\u5e76\u8bf7\u6c42\u89c6\u56fe\u4e0a\u7ebf\u5566<br />\u5728\u8fd9\u91cc\u53ef\u4ee5\u67e5\u770b\u5408\u5e76\u6761\u4ef6\u54e6\uff5e"},a.a.createElement("div",{className:"".concat("mr-request-info","-title")},a.a.createElement("div",{className:"".concat("mr-request-info","-img")},a.a.createElement("img",{alt:"\u672a\u8fbe\u5230\u5408\u5e76\u8981\u6c42",className:"".concat("mr-request-info","-yundou"),src:"https://img.alicdn.com/tfs/TB1ruuhIKL2gK0jSZPhXXahvXXa-372-294.png"})),a.a.createElement("div",{className:"".concat("mr-request-info","-tip")},"\u672a\u8fbe\u5230\u5408\u5e76\u8981\u6c42\uff0c\u7ee7\u7eed\u52aa\u529b\u5427\uff01")),a.a.createElement("div",{className:"mr-request-list"},"cannot_be_merged"===o.mergeStatus?a.a.createElement("div",{className:"mr-request-list-item space-between"},a.a.createElement("div",{className:"mr-confilct-tip"},a.a.createElement(F.default,{align:"t",trigger:a.a.createElement("span",null,a.a.createElement("span",{className:"mr-request-list-item-icon"},a.a.createElement(m.a,{type:"clock-fill",style:{color:"#8c8c8c"}})),a.a.createElement("span",null,"\u4ee3\u7801\u5b58\u5728\u51b2\u7a81\uff0c"),a.a.createElement("span",{className:"conflict-desc"},"false"===n?"\u53ef\u4f7f\u7528 Web \u7aef\u7f16\u8f91\u5668\u6216\u547d\u4ee4\u884c\u89e3\u51b3\u51b2\u7a81":"\u53ef\u4f7f\u7528\u547d\u4ee4\u884c\u89e3\u51b3\u51b2\u7a81"))},a.a.createElement("span",null,a.a.createElement("span",null,"\u4ee3\u7801\u5b58\u5728\u51b2\u7a81\uff0c"),a.a.createElement("span",{className:"conflict-desc"},"false"===n?"\u53ef\u4f7f\u7528 Web \u7aef\u7f16\u8f91\u5668\u6216\u547d\u4ee4\u884c\u89e3\u51b3\u51b2\u7a81":"\u53ef\u4f7f\u7528\u547d\u4ee4\u884c\u89e3\u51b3\u51b2\u7a81")))),a.a.createElement("div",{className:"mr-request-list-item-right"},this.renderWebIdeBtn(),a.a.createElement(u.Balloon.Tooltip,{trigger:a.a.createElement("span",null,a.a.createElement(u.Button,{type:"normal",size:"small",onClick:function e(){Object(s.b)({action:"resolve_conflict_by_cli",page:"Repo-MR",mr_id:o.id}),t.onDialogOpen()}},"\u672c\u5730\u89e3\u51b3"),this.conflictTipsDialogJsx()),align:"t",text:"\u70b9\u51fb\u4e86\u89e3\u51b2\u7a81\u89e3\u51b3\u65b9\u6cd5\u53c2\u8003"}))):null,("opened"===o.state||"reopened"===o.state)&&this.approveCheckResultListJsx(),a.a.createElement(q,this.props)))}}]),n}(r.Component),oe=n(30),ce=n(19),ie=n(1526),le=n(5),se=n(9),ue=n(166),me=n.n(ue),fe=n(1651);function pe(e){return(pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function e(t){return typeof t}:function e(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function de(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function he(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ge(e,t,n){return t&&he(e.prototype,t),n&&he(e,n),e}function ye(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ve(e,t)}function ve(e,t){return(ve=Object.setPrototypeOf||function e(t,n){return t.__proto__=n,t})(e,t)}function be(e){var t=we();return function n(){var r=Ne(e),a;if(t){var o=Ne(this).constructor;a=Reflect.construct(r,arguments,o)}else a=r.apply(this,arguments);return Ee(this,a)}}function Ee(e,t){return!t||"object"!==pe(t)&&"function"!=typeof t?_e(e):t}function _e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function we(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Ne(e){return(Ne=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)})(e)}var Oe="mr-basic-info-assignees-detail",Re=function(e){ye(n,e);var t=be(n);function n(){return de(this,n),t.apply(this,arguments)}return ge(n,[{key:"render",value:function e(){var t=this,n=this.props,r=n.value,o=n.needAvatar,c=r.map((function(e){switch(e._userId=e._userId||e.tb_user_id,e.status){case"approved":e.statusText="\u5df2\u901a\u8fc7",e.marker=a.a.createElement("div",{className:"mr-overview-avatar-marker commented"},a.a.createElement("img",{src:"https://img.alicdn.com/tfs/TB1.4QPii_1gK0jSZFqXXcpaXXa-24-24.png",alt:""}));break;case"comment":e.statusText="\u5df2\u8bc4\u8bba",e.marker=a.a.createElement("div",{className:"mr-overview-avatar-marker reviewed"},a.a.createElement("img",{src:"https://img.alicdn.com/tfs/TB1THZNieL2gK0jSZPhXXahvXXa-24-24.png",alt:""}));break;case"pending":e.statusText="\u672a\u901a\u8fc7",e.marker=a.a.createElement("div",{className:"mr-overview-avatar-marker not-reviewed"},a.a.createElement("img",{src:"https://img.alicdn.com/tfs/TB1kVgRihv1gK0jSZFFXXb0sXXa-24-24.png",alt:""}));break;default:e.statusText="",e.marker=null}return e}));return c&&c.length?a.a.createElement("div",{className:"".concat(Oe," hasData ").concat(o?"needAvatar":""),onClick:this.onClickTrigger,ref:function e(n){t.triggerEle=n}},c.map((function(e,t){return a.a.createElement(a.a.Fragment,null,e.status?a.a.createElement(u.Balloon.Tooltip,{trigger:a.a.createElement(me.a,{image:e.avatar_url,text:e.name,needAddedText:!0,size:"xs",marker:e.marker}),type:"primary",align:"t"},e.statusText):a.a.createElement("span",null,e.name,t!==c.length-1?"\uff0c":""))}))):a.a.createElement("div",{className:"".concat(Oe," wait")},a.a.createElement(m.a,{type:"user-o",style:{color:"#bfbfbf",marginRight:4}}),"\u672a\u6dfb\u52a0\u8bc4\u5ba1\u4eba")}}]),n}(a.a.Component),Se=n(13),je=n(4),Ce=n(1652);function Pe(e){return(Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function e(t){return typeof t}:function e(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function Te(e,t){return De(e)||xe(e,t)||Ie(e,t)||ke()}function ke(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ie(e,t){if(e){if("string"==typeof e)return Be(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Be(e,t):void 0}}function Be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function xe(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r=[],a=!0,o=!1,c,i;try{for(n=n.call(e);!(a=(c=n.next()).done)&&(r.push(c.value),!t||r.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(o)throw i}}return r}}function De(e){if(Array.isArray(e))return e}function Ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Le(e,t,n){return t&&Me(e.prototype,t),n&&Me(e,n),e}function qe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fe(e,t)}function Fe(e,t){return(Fe=Object.setPrototypeOf||function e(t,n){return t.__proto__=n,t})(e,t)}function Xe(e){var t=Ge();return function n(){var r=Je(e),a;if(t){var o=Je(this).constructor;a=Reflect.construct(r,arguments,o)}else a=r.apply(this,arguments);return Ue(this,a)}}function Ue(e,t){return!t||"object"!==Pe(t)&&"function"!=typeof t?We(e):t}function We(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ge(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Je(e){return(Je=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)})(e)}function Ke(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var He=window.FORCE.pathResource,ze="mr-basic-info",Ve=function(e){qe(n,e);var t=Xe(n);function n(e){var r;return Ae(this,n),Ke(We(r=t.call(this,e)),"getRecommendReviewers",(function(e,t,n,r){if(null!==e){var a={};t&&(a.source_version=t),n&&(a.target_version=n),je.a.forceFetch({api:"merge_request.reviewer_recommend.get",params:{projectId:e},data:a}).then((function(e){var t=e.list.sort((function(e,t){return t.score-e.score}));r(t)})).catch((function(e){console.log(e)}))}else r([])})),Ke(We(r),"onSelectMember",(function(e){var t=r.props.codeReviewDetail,n=t.assignees,a=r.state.defaultReviewerList,o={};o.tb_user_ids=e.map((function(e){return e._userId||e.tb_user_id})).join(","),r.props.modifyCr(o);var c=n?n.map((function(e){return e.id})):[],i=e?e.map((function(e){return e.id})):[],l,u=a.filter((function(e){return e.tag&&"\u63a8\u8350"===e.tag.children&&i.includes(e.id)})).map((function(e){return{user_id:e.id,score:e.score}}));if(Object(s.b)({action:"mr_reviewer_chang",page:"Repo-MR",type:"",mr_id:t.id,original_reviewers:JSON.stringify(c),new_reviewers:JSON.stringify(i)}),u&&u.length){var m=e?e.map((function(e){return{user_id:e.id}})):[];Object(s.b)({action:"reviewer_modify",page:"Repo-MR",type:"",mr_id:t.id,user_id:window.FORCE.user?window.FORCE.user.id:"",code_user_id:window.FORCE.user?window.FORCE.user.codeUserId:"",recommend_reviewers:JSON.stringify(u),assignees:JSON.stringify(m)})}})),r.state={defaultReviewerList:[]},r}return Le(n,[{key:"componentDidMount",value:function e(){var t=this,n=this.props.codeReviewDetail,r=n.source_branch,a=n.target_branch,o=n.state;this.props.is_enable_reviewer_recommend&&"closed"!==o&&"merged"!==o&&Promise.all([this.getLastCommit(r),this.getLastCommit(a)]).then((function(e){var n=Te(e,2),r=n[0],a=n[1],o=r.id,c=a.id;t.getRecommendReviewers(He.id,o,c,(function(e){t.setState({defaultReviewerList:e})}))}))}},{key:"getLastCommit",value:function e(t){return new Promise((function(e){je.a.forceFetch({api:"projects.files.last_commit",params:{projectId:He.id},data:{sha:t,filepath:"/"}}).then((function(t){e(t)}))}))}},{key:"render",value:function e(){var t=this.state.defaultReviewerList,n=this.props,r=n.codeReviewDetail,o=n.changeRequest,c=He.role,i=r.assignees,l=r.attributes&&r.attributes.length&&"merge_request_time"===r.attributes[0].attributeType?JSON.parse(r.attributes[0].attributeInfo).time_doc:"",s=null;s="unsupported"===l?a.a.createElement("div",null,"\u6682\u65e0",a.a.createElement(u.Balloon.Tooltip,{trigger:a.a.createElement(u.Button.Icon,{type:"secondary",color:"gray",name:"question-o",style:{marginLeft:4,display:"inline-block"}}),align:"t"},"\u6587\u4ef6\u7c7b\u578b\u6682\u4e0d\u652f\u6301\u9884\u4f30\uff0c\u67e5\u770b",a.a.createElement("a",{href:Object(Se.a)("\u8bc4\u5ba1\u8017\u65f6\u9884\u4f30"),target:"_blank",style:{color:"#488ee2"}},"\u670d\u52a1\u8bf4\u660e"))):l.startsWith(">")?"\u5927\u4e8e ".concat(l.slice(1)," \u5206\u949f"):"\u7ea6 ".concat(l," \u5206\u949f");var m=se.a&&!r.is_support_reassign;return a.a.createElement("div",{className:"".concat("mr-basic-info")},a.a.createElement("div",{className:"".concat("mr-basic-info","-title")},"\u57fa\u672c\u4fe1\u606f"),a.a.createElement("div",{className:"".concat("mr-basic-info","-time")},l?a.a.createElement("div",{className:"".concat("mr-basic-info","-time-left")},a.a.createElement("div",{className:"title"},a.a.createElement("span",null,"\u8017\u65f6\u9884\u4f30")),a.a.createElement("div",{className:"content"},s)):null,a.a.createElement("div",{className:"".concat("mr-basic-info","-time-right")},a.a.createElement("div",{className:"title"},"\u521b\u5efa\u65f6\u95f4"),a.a.createElement("div",{className:"content"},X.b.getBeautyTime(r.created_at)))),a.a.createElement("div",{className:"".concat("mr-basic-info","-assignees")},a.a.createElement("div",{className:"".concat("mr-basic-info","-assignees-title")},a.a.createElement("div",null,"\u8bc4\u5ba1\u4eba"),a.a.createElement("div",{className:"".concat("mr-basic-info","-assignees-title-right")},!m&&Object(ce.a)(v.g,c)?a.a.createElement(oe.a,{useRecommendMember:t&&t.length,recommendList:t,useExtraMember:"project",useProjectMember:!0,onChange:this.onSelectMember,value:i,align:"tr br",needAvatar:!0,multiple:!0,trigger:a.a.createElement(u.Button.Icon,{type:"primary",name:"plus",color:"gray"}),pathResourceId:Number(window.FORCE.pathResource.id)}):a.a.createElement(u.Balloon.Tooltip,{trigger:a.a.createElement(u.Button.Icon,{type:"primary",name:"plus",color:"gray",disabled:!0}),align:"t",triggerType:"hover"},m?r.unsupport_reassign_message:"\u65e0\u6743\u9650\u8fdb\u884c\u7f16\u8f91\u64cd\u4f5c\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u7533\u8bf7\u5bf9\u5e94\u7684\u6743\u9650"))),a.a.createElement("div",{className:"".concat("mr-basic-info","-assignees-content")},a.a.createElement(Re,{value:i,needAvatar:!0}))),se.a?a.a.createElement("div",{className:"".concat("mr-basic-info","-change")},a.a.createElement("div",{className:"".concat("mr-basic-info","-change-title")},"\u5173\u8054\u53d8\u66f4"),a.a.createElement("p",{className:"mr-overview-right-workitem-list"},a.a.createElement("div",{style:{flex:"auto"}},o&&o.length?a.a.createElement("div",null,o.map((function(e){return a.a.createElement("div",{className:"mr-overview-right-workitem-list-item"},a.a.createElement("a",{className:"text-black",href:e.link,target:"_blank"},e.subject))}))):a.a.createElement("span",{className:"text-grey"},le.a.text_null)))):null,se.a?null:a.a.createElement(ie.a,{identifier:"plugin_for_code_mr",container:{target:"merge_request",id:r.id}}))}}]),n}(r.Component),Ze=n(45),Qe=n.n(Ze),Ye=n(38),$e=n(165),et=n(1471),tt=n(3),nt=n.n(tt),rt=n(1455),at=n(289),ot=n(94),ct=n(1473),it=n(1511);function lt(e){return(lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function e(t){return typeof t}:function e(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function st(){return(st=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ut(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function mt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ft(e,t,n){return t&&mt(e.prototype,t),n&&mt(e,n),e}function pt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dt(e,t)}function dt(e,t){return(dt=Object.setPrototypeOf||function e(t,n){return t.__proto__=n,t})(e,t)}function ht(e){var t=vt();return function n(){var r=bt(e),a;if(t){var o=bt(this).constructor;a=Reflect.construct(r,arguments,o)}else a=r.apply(this,arguments);return gt(this,a)}}function gt(e,t){return!t||"object"!==lt(t)&&"function"!=typeof t?yt(e):t}function yt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function bt(e){return(bt=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)})(e)}var Et=function(e){pt(n,e);var t=ht(n);function n(){return ut(this,n),t.apply(this,arguments)}return ft(n,[{key:"render",value:function e(){var t,n,r,o=this.props.log.noteData[0].noteList.map((function(e){return e.author||(e.author={avatar_url:e.author_avatar_url,extern_uid:e.author_extern_uid,id:e.author_id,name:e.author_name,state:e.author_state,username:e.author_username}),e}));return a.a.createElement("div",{className:"log-detail-common-body"},a.a.createElement(ct.a,st({conversation:o,noDraft:!0},this.props)))}}]),n}(r.Component),_t=n(1472),wt=n(1537);function Nt(e){return(Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function e(t){return typeof t}:function e(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function Ot(){return(Ot=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function St(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rt(Object(n),!0).forEach((function(t){Wt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function jt(e,t){return It(e)||kt(e,t)||Pt(e,t)||Ct()}function Ct(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Pt(e,t){if(e){if("string"==typeof e)return Tt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Tt(e,t):void 0}}function Tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function kt(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r=[],a=!0,o=!1,c,i;try{for(n=n.call(e);!(a=(c=n.next()).done)&&(r.push(c.value),!t||r.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(o)throw i}}return r}}function It(e){if(Array.isArray(e))return e}function Bt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Dt(e,t,n){return t&&xt(e.prototype,t),n&&xt(e,n),e}function At(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mt(e,t)}function Mt(e,t){return(Mt=Object.setPrototypeOf||function e(t,n){return t.__proto__=n,t})(e,t)}function Lt(e){var t=Xt();return function n(){var r=Ut(e),a;if(t){var o=Ut(this).constructor;a=Reflect.construct(r,arguments,o)}else a=r.apply(this,arguments);return qt(this,a)}}function qt(e,t){return!t||"object"!==Nt(t)&&"function"!=typeof t?Ft(e):t}function Ft(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Ut(e){return(Ut=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)})(e)}function Wt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Gt=function(e){At(n,e);var t=Lt(n);function n(){var e;Bt(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return Wt(Ft(e=t.call.apply(t,[this].concat(a))),"handleGoFile",(function(t,n,r){if(!r){var a=window.FORCE,o=a.pathResource,c=a.codeReviewDetail,i="/".concat(o.fullPath,"/merge_request/").concat(c.id),l=n?{line:n.begin_line,side:"right"}:e.props.getLineInfo(t),s=l.line,u=l.side;if(Object(y.d)("".concat(i,"/changes")),e.props.changeMrTabKey("changes"),n)window.location.hash="#file=".concat(E()(n.file_name),"&line=").concat(s,"&side=").concat(u);else{var m="";try{var f,p=e.props.changesReducer.inline_comments.find((function(e){return e.id===t.id}));if(p.outdated){var d,h=jt(p.range_context.split(" "),2),g=h[0],v=h[1];g&&!v&&(v=g),v&&!g&&(g=v),m="&from_commit=".concat(g,"&to_commit=").concat(v)}}catch(e){console.error(e)}window.location.hash="#file=".concat(E()(t.new_path),"&line=").concat(s,"&side=").concat(u).concat(m)}}})),e}return Dt(n,[{key:"renderNote",value:function e(t,n){var r=this,o=t,c=o.noteList[0],i=t.issue,l=i?{line:i.begin_line,side:"right",from_commit:"",to_commit:""}:this.props.getLineInfo(c),s=l.line,m=l.side,f=l.to_commit,p=l.from_commit,d=l.closed,h=l.id,g=o.noteList.map((function(e){return e.author||(e.author={avatar_url:e.author_avatar_url,extern_uid:e.author_extern_uid,id:e.author_id,name:e.author_name,state:e.author_state,username:e.author_username}),e})),y="",v=i&&i.status&&"resolved"===i.status.toLowerCase();v?y="\u5df2\u8fc7\u671f":s&&(y="\u7b2c".concat(s,"\u884c"));var b=i?i.file_name:c.new_path;return a.a.createElement("div",{style:{marginTop:0===n?0:16}},a.a.createElement(_t.a,{noBorderRadius:!0,id:"log_file_".concat(b?E()(b):"")},a.a.createElement(_t.a.Header,null,a.a.createElement("div",{className:"log-detail-file-header"},a.a.createElement("div",{className:"title"},a.a.createElement("a",{className:"log-file-name ".concat(v?"outdated":""),onClick:function e(){r.handleGoFile(c,i,v)}},i?i.file_name:c.new_path,a.a.createElement("span",null,"\xa0",y))),!i&&a.a.createElement(u.Checkbox,{checked:!!d,onChange:function e(){r.props.toggleComment({noteId:h,closed:!d})},className:"discuss-checkbox",style:{marginRight:"5px"}},d?"\u5df2\u89e3\u51b3":"\u5f85\u89e3\u51b3"))),a.a.createElement(_t.a.Body,{noPadding:!0},a.a.createElement("div",{className:"log-detail-file-body"},i?a.a.createElement("div",null,a.a.createElement(wt.a,{rule:i,author:{name:"\u4e91\u8c46",avatar_url:"https://img.alicdn.com/tfs/TB1WYSpIQL0gK0jSZFtXXXQCXXa-400-401.png"},commentEle:a.a.createElement(ct.a,St(St({conversation:g,line:s,side:"right",newpath:i.file_name,readOnly:g[0]&&g[0].is_draft,issueId:i.id,isYundouComment:!0},this.props),{},{noDraft:!0}))})):a.a.createElement(ct.a,Ot({issueId:i?i.id:"",conversation:g,to_commit:f,from_commit:p,line:s,noDraft:!0,side:m},this.props))))))}},{key:"render",value:function e(){var t=this,n,r=this.props.log.noteData;return a.a.createElement("div",{className:""},r.map((function(e,n){return t.renderNote(e,n)})))}}]),n}(r.Component);function Jt(e){return(Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function e(t){return typeof t}:function e(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function Kt(e){return Vt(e)||zt(e)||Yt(e)||Ht()}function Ht(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function zt(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Vt(e){if(Array.isArray(e))return $t(e)}function Zt(e,t){return tn(e)||en(e,t)||Yt(e,t)||Qt()}function Qt(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Yt(e,t){if(e){if("string"==typeof e)return $t(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$t(e,t):void 0}}function $t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function en(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r=[],a=!0,o=!1,c,i;try{for(n=n.call(e);!(a=(c=n.next()).done)&&(r.push(c.value),!t||r.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(o)throw i}}return r}}function tn(e){if(Array.isArray(e))return e}function nn(){return(nn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function rn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function an(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function on(e,t,n){return t&&an(e.prototype,t),n&&an(e,n),e}function cn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ln(e,t)}function ln(e,t){return(ln=Object.setPrototypeOf||function e(t,n){return t.__proto__=n,t})(e,t)}function sn(e){var t=fn();return function n(){var r=pn(e),a;if(t){var o=pn(this).constructor;a=Reflect.construct(r,arguments,o)}else a=r.apply(this,arguments);return un(this,a)}}function un(e,t){return!t||"object"!==Jt(t)&&"function"!=typeof t?mn(e):t}function mn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fn(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function pn(e){return(pn=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)})(e)}function dn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var hn=function(e){cn(n,e);var t=sn(n);function n(){var e;rn(this,n);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return dn(mn(e=t.call.apply(t,[this].concat(o))),"renderContent",(function(t){return t?a.a.createElement(Et,e.props):a.a.createElement(Gt,nn({},e.props,{getLineInfo:e.getLineInfo}))})),dn(mn(e),"getLineInfo",(function(t){var n,r=e.props.changesReducer.inline_comments.find((function(e){return e.id===t.id}))||{},a=r.side||"right",o=r.line,c=r.range_context,i=r.closed,l=r.id,s="",u="";if(c){var m,f=Zt(c.split(" "),2);u=f[0],s=f[1]}return{side:a,line:o,to_commit:s,from_commit:u,closed:i,id:l}})),dn(mn(e),"renderTitle",(function(t){var n=e.props.log;return t?a.a.createElement("span",null,"\u53d1\u5e03\u4e86\u6574\u4f53\u8bc4\u8bba"):a.a.createElement("span",null,"BOT"===n.avatarType?"\u53d1\u73b0\u7684\u95ee\u9898\u88ab\u8bc4\u8bba":"\u53d1\u5e03\u4e86\u8bc4\u8bba")})),e}return on(n,[{key:"render",value:function e(){var t=this.props.log,n,r=Kt(t.noteData)[0],o=r.noteList[0],c="BOT"===t.avatarType,i=!o.line_code&&!c,l="\u4e91\u8c46",s="https://img.alicdn.com/tfs/TB1WYSpIQL0gK0jSZFtXXXQCXXa-400-401.png";return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"log-item-title has-pb",style:{paddingBottom:12}},a.a.createElement("div",{className:"log-item-title-info"},a.a.createElement("div",{className:"log-item-title-author mr0"},a.a.createElement(u.Balloon.Tooltip,{align:"t",trigger:a.a.createElement(me.a,{image:c?s:o.author_avatar_url,text:c?l:o.author_name,needAddedText:!0,size:"xs"}),text:c?l:o.author_name})),"\xa0",a.a.createElement("div",{className:"note-content-wrapper"},this.renderTitle(i,o))),a.a.createElement("div",{className:"log-item-title-time"},X.b.getBeautyTime("BOT"===t.avatarType&&r.issue?r.issue.intro_time:o.created_at))),a.a.createElement("div",{className:"log-item-detail"},this.renderContent(i)))}}]),n}(a.a.Component);function gn(e){return(gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function e(t){return typeof t}:function e(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function yn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bn(e,t,n){return t&&vn(e.prototype,t),n&&vn(e,n),e}function En(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_n(e,t)}function _n(e,t){return(_n=Object.setPrototypeOf||function e(t,n){return t.__proto__=n,t})(e,t)}function wn(e){var t=Rn();return function n(){var r=Sn(e),a;if(t){var o=Sn(this).constructor;a=Reflect.construct(r,arguments,o)}else a=r.apply(this,arguments);return Nn(this,a)}}function Nn(e,t){return!t||"object"!==gn(t)&&"function"!=typeof t?On(e):t}function On(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rn(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Sn(e){return(Sn=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)})(e)}function jn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Cn=new h.a({highlight:function e(t,n){if(n&&Qe.a.getLanguage(n))try{return Qe.a.highlight(n,t).value}catch(e){return""}return""}}),Pn={APPROVE:"user-add",MERGE:"merge",SEE:"user",REMOVE:"user",PUSH:"commit",CLOSE:"remove",REOPEN:"arrow-clock-right",ACCEPT:"tick-o-fill",OTHER:"gear",BOT:"code-robot",AUTHOR:"chat-group-stroke"},Tn=u.Tag.Colorable,kn=function(e){En(n,e);var t=wn(n);function n(e){var r;return yn(this,n),jn(On(r=t.call(this,e)),"onChange",(function(e,t){e.preventDefault(),r.setState({isShowCommitDetail:!0,commitID:t})})),jn(On(r),"closeCommitDetail",(function(){r.setState({isShowCommitDetail:!1})})),r.state={isMsgDescVisible:!1,isShowCommitDetail:!1,commitID:""},r}return bn(n,[{key:"logIconJsx",value:function e(t){var n=Pn.OTHER;Pn[t]&&(n=Pn[t]);var r=null;return r="MERGE"===t||"BOT"===t||"PUSH"===t?a.a.createElement(m.a,{type:n,biz:"code"}):a.a.createElement(m.a,{type:n}),a.a.createElement("div",{className:"log-item-icon"},r,a.a.createElement("div",{className:"log-line"}))}},{key:"logPUSHContentJsx",value:function e(t){var n=this,r=this.state.isMsgDescVisible,o=this.props.projectInfo,c=window.FORCE.pathResource.fullPath,i=t.note.split("\n\n"),l=i[0].split(":"),s=i[1]?i[1].split("\n"):"",u=s?s.map((function(e){return e.split("- ")})):"",f=u?u.map((function(e){return e.slice(1)})):"",p=l[1]&&l[1].split(","),d=p&&1===p.length&&p[0].split("...");return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"log-item-title"},a.a.createElement("div",{className:"log-item-title-info commit-logs"},a.a.createElement("div",{className:"log-item-title-author"},"\u4e91\u8c46"===t.author_name?a.a.createElement(me.a,{image:"https://img.alicdn.com/tfs/TB1WYSpIQL0gK0jSZFtXXXQCXXa-400-401.png",text:t.author_name,size:"xs"}):a.a.createElement(me.a,{image:t.author_avatar_url,text:t.author_name,size:"xs"})),a.a.createElement("div",{className:"note-user-name"},t.author_name),"\u4e91\u8c46"===t.author_name&&a.a.createElement("div",{className:"log-item-title-author-tag"},a.a.createElement(Tn,{color:"gray"},"bot")),"\u4e91\u8c46"===t.author_name?null:a.a.createElement("span",null,"\xa0"),a.a.createElement("div",{className:"log-item-title-content"},l[0]),"\xa0",a.a.createElement("div",null,p&&1===p.length&&d.length<2&&a.a.createElement("a",{className:"text-black desc-title-lh",onClick:function e(t){return n.onChange(t,p[0].trim())}},p[0].slice(0,8)),p&&2===p.length&&a.a.createElement(y.a,{to:"/".concat(c,"/compare?from=").concat(encodeURIComponent(p[0]),"&to=").concat(encodeURIComponent(p[1]),"&tab=activity"),className:"text-black"},p[0].slice(0,8),",",p[1].slice(0,8)),d&&d.length>=2&&a.a.createElement(y.a,{to:"/".concat(c,"/compare?from=").concat(encodeURIComponent(d[0]),"&to=").concat(encodeURIComponent(d[1]),"&tab=activity"),className:"text-black"},d[0].slice(0,8),"...",d[1].slice(0,8))),u?a.a.createElement("span",{className:"show-more-span",onClick:function e(){n.setState({isMsgDescVisible:!r})}},a.a.createElement(m.a,{type:r?"chevron-up-s":"chevron-down-s",className:"show-more-icon"})):null),a.a.createElement("div",{className:"log-item-title-time"},X.b.getBeautyTime(t.created_at))),a.a.createElement("div",{className:"log-item-detail"},f&&r?a.a.createElement("div",{className:"log-item-push-list"},f.map((function(e){return a.a.createElement("div",{className:"log-item-push-list-item"},a.a.createElement("a",{onClick:function t(r){n.onChange(r,e[0].trim())},className:"sha"},e[0].substring(0,8)),a.a.createElement("span",{style:{marginLeft:8,marginRight:8}},e[1]),a.a.createElement(at.a,{container:{target:"commit",id:e[0]},projectInfo:o}))}))):null))}},{key:"logItemContentJsx",value:function e(t){var n="BOT"===t.avatarType&&t.noteData.some((function(e){return e.issue}));if(t.authorDTO||n)return a.a.createElement(hn,this.props);var r=t.noteData[0].noteList[0];return"PUSH"===t.avatarType?this.logPUSHContentJsx(r):a.a.createElement("div",{className:"log-item-title has-pb"},a.a.createElement("div",{className:"log-item-title-info normal"},a.a.createElement("div",{className:"log-item-title-author"},"\u4e91\u8c46"===r.author_name?a.a.createElement("div",{className:"log-item-title-author-yundou"},a.a.createElement(me.a,{image:"https://img.alicdn.com/tfs/TB1WYSpIQL0gK0jSZFtXXXQCXXa-400-401.png",text:r.author_name,size:"xs"})):a.a.createElement(me.a,{image:r.author_avatar_url,text:r.author_name,size:"xs"})),a.a.createElement("div",{className:"note-content-wrapper"},a.a.createElement("div",{className:"note-user-name"},a.a.createElement("span",null,r.author_name),"\u4e91\u8c46"===r.author_name&&a.a.createElement("span",{className:"log-item-title-author-tag"},a.a.createElement(Tn,{color:"gray"},"bot")),"\u4e91\u8c46"===r.author_name?null:a.a.createElement("span",null,"\xa0")),a.a.createElement("div",{className:"mr-log-tooltip markdown-body",dangerouslySetInnerHTML:{__html:Object(ot.filterXSS)(Cn.render(r.note||""),{onIgnoreTagAttr:function e(t,n,r){return"".concat(n,"=").concat(r)}})}}))),a.a.createElement("div",{className:"log-item-title-time"},X.b.getBeautyTime(r.created_at)))}},{key:"render",value:function e(){var t=this.props.log;return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"log-item"},a.a.createElement("div",{className:"log-item-left"},this.logIconJsx(t.avatarType)),a.a.createElement("div",{className:"log-item-right"},this.logItemContentJsx(t))),this.state.isShowCommitDetail?a.a.createElement(rt.a,{commitId:this.state.commitID,onChange:this.closeCommitDetail,container:document.getElementById("container")}):null)}}]),n}(a.a.Component);jn(kn,"propTypes",{log:nt.a.object,projectInfo:nt.a.object});var In=n(1655);function Bn(e){return(Bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function e(t){return typeof t}:function e(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function xn(){return(xn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Dn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function An(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Mn(e,t,n){return t&&An(e.prototype,t),n&&An(e,n),e}function Ln(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qn(e,t)}function qn(e,t){return(qn=Object.setPrototypeOf||function e(t,n){return t.__proto__=n,t})(e,t)}function Fn(e){var t=Wn();return function n(){var r=Gn(e),a;if(t){var o=Gn(this).constructor;a=Reflect.construct(r,arguments,o)}else a=r.apply(this,arguments);return Xn(this,a)}}function Xn(e,t){return!t||"object"!==Bn(t)&&"function"!=typeof t?Un(e):t}function Un(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wn(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Gn(e){return(Gn=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)})(e)}function Jn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Kn=window.FORCE.pathResource,Hn=new h.a({html:!0,linkify:!0,breaks:!0,typographer:!0,highlight:function e(t,n){if(n&&Qe.a.getLanguage(n))try{return Qe.a.highlight(n,t).value}catch(e){return""}return""}}),zn,Vn=v.a.getOSKeyMap().ctrlTxt,Zn="mr-logs",Qn=function(e){Ln(n,e);var t=Fn(n);function n(e){var r;return Dn(this,n),Jn(Un(r=t.call(this,e)),"onCancelEditing",(function(){r.setState({isEditing:!1})})),Jn(Un(r),"onDescClick",(function(){r.setState({isEditing:!0})})),Jn(Un(r),"onMDSubmit",(function(e){var t={};t.description=e,r.props.modifyCr(t),r.onCancelEditing()})),Jn(Un(r),"renderDesc",(function(){var e=r.props.codeReviewDetail,t=e.description,n=e.is_support_modify,o=e.unsupport_modify_message,c=Kn.role,i=r.state.isEditing,l=Object(ce.a)(v.g,c),s;return se.a&&!n?a.a.createElement(u.Balloon.Tooltip,{trigger:a.a.createElement("div",{className:"markdown-body not-allowed",onClick:r.onDescClick,dangerouslySetInnerHTML:{__html:t?Object(ot.filterXSS)(Hn.render(t||"")):"\u53d1\u8d77\u4eba\u5f88\u5fd9\uff0c\u6ca1\u6709\u7559\u4e0b\u4efb\u4f55\u4fe1\u606f"}}),align:"t",triggerType:"hover"},o):i?a.a.createElement(Ye.a,{placeholder:"\u8bf7\u8f93\u5165\u63cf\u8ff0",initValue:e.description,onSubmit:function e(t){return r.onMDSubmit(t)},onCancel:r.onCancelEditing}):t?l?a.a.createElement(u.Balloon.Tooltip,{trigger:a.a.createElement("div",{className:"markdown-body",onClick:r.onDescClick,dangerouslySetInnerHTML:{__html:Object(ot.filterXSS)(Hn.render(t||""),{onIgnoreTagAttr:function e(t,n,r){return"".concat(n,"=").concat(r)}})}}),align:"t",triggerType:"hover"},"\u70b9\u51fb\u5373\u53ef\u7f16\u8f91"):a.a.createElement("div",{className:"markdown-body",dangerouslySetInnerHTML:{__html:Object(ot.filterXSS)(Hn.render(t||""),{onIgnoreTagAttr:function e(t,n,r){return"".concat(n,"=").concat(r)}})}}):l?a.a.createElement(u.Input,{style:{width:"100%"},onClick:r.onDescClick,placeholder:"\u6dfb\u52a0\u63cf\u8ff0..."}):a.a.createElement("div",{className:"desc-placeholder"},"\u53d1\u8d77\u4eba\u5f88\u5fd9\uff0c\u6ca1\u6709\u7559\u4e0b\u4efb\u4f55\u4fe1\u606f")})),Jn(Un(r),"showAllCommentArea",(function(){var e=r.props,t=e.changesReducer,n=e.mrCommentConfig,a=t.allComments,o=void 0===a?[]:a,c;"false"===Kn.isArchive&&X.b.allowComments(o.length,n)&&r.setState({isEditorShow:!0})})),Jn(Un(r),"getCurSummaryLogs",(function(){var e=r.props.summaryLogs;if(!e)return[];var t=r.state.logType;return e.filter((function(e){return"action"!==t||"AUTHOR"!==e.avatarType}))})),Jn(Un(r),"onSubmitWhole",(function(e,t,n){var a=r.props.codeReviewDetail;r.props.postInlineComments({note:e,parent_note_id:n||"",is_draft:!!t},(function(){r.setState({isEditorShow:!1})})),Object(s.b)({action:"post_overall_comment",page:"Repo-MR",type:"",mr_id:a.id})})),Jn(Un(r),"renderMd",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return a.a.createElement(Ye.a,{onSubmitImmediate:r.onSubmitWhole,onCancel:function e(){r.setState({isEditorShow:!1})},placeholder:"\u8bf7\u8f93\u5165\u8bc4\u8bba",help:e?"".concat(Vn," + Shift + Enter \u76f4\u63a5\u53d1\u5e03"):"".concat(Vn," + Enter \u5b58\u8349\u7a3f\uff0c").concat(Vn," + Shift + Enter \u76f4\u63a5\u53d1\u5e03"),size:"medium",submitBtnText:e?"":"\u4fdd\u5b58\u4e3a\u8349\u7a3f",initValue:""})})),r.state={isEditing:!1,isMoreData:!1,logType:"all",isEditorShow:!1},r}return Mn(n,[{key:"render",value:function e(){var t=this,n=this.props,r=n.codeReviewDetail,o=n.changesReducer,c=n.mrCommentConfig,i=o.allComments,l=void 0===i?[]:i,f=r.author,p=r.created_at,d=r.is_auto_create,h=this.state.logType,g=Kn.role,y=Object(ce.a)(v.g,g),b="false"===Kn.isArchive&&X.b.allowComments(l.length,c),E=this.getCurSummaryLogs(),_=E.length,w=window.FORCE.user;return a.a.createElement("div",{className:"".concat("mr-logs")},a.a.createElement("div",{className:"".concat("mr-logs","-title")},a.a.createElement("div",{className:"".concat("mr-logs","-title-left")},"\u6700\u65b0\u52a8\u6001"),a.a.createElement("div",{className:"".concat("mr-logs","-title-right")},a.a.createElement(u.Select,{value:h,onChange:function e(n){t.setState({logType:n}),Object(s.b)({action:"mr_activity_filter",page:"Repo-MR",type:"",mr_id:r.id,filter:"all"===n?"all":"operation_history"})},style:{width:100,minWidth:"auto"},hasBorder:!1,popupProps:{align:"tr br"},size:"xs"},a.a.createElement(u.Select.Option,{value:"all"},"\u5168\u90e8\u52a8\u6001"),a.a.createElement(u.Select.Option,{value:"action"},"\u64cd\u4f5c\u5386\u53f2")))),a.a.createElement("div",{className:"".concat("mr-logs","-content")},a.a.createElement("div",{className:"".concat("mr-logs","-content-desc")},a.a.createElement("div",{className:"".concat("mr-logs","-content-desc-left")},a.a.createElement(m.a,{type:"chat-group-stroke",className:"mr-log-chat-icon"}),a.a.createElement("span",{className:"log-line"})),a.a.createElement("div",{className:"".concat("mr-logs","-content-desc-right")},a.a.createElement("div",{className:"title"},a.a.createElement("div",{className:"title-left"},!0===d||"true"===d?a.a.createElement(et.a,{hasAvatar:!0}):a.a.createElement(u.Balloon.Tooltip,{align:"t",trigger:a.a.createElement(me.a,{image:f.avatar_url,text:f.name,needAddedText:!0,size:"xs"}),text:f.name}),"\xa0",a.a.createElement("span",null,"\u521b\u5efa\u4e86\u5408\u5e76\u8bf7\u6c42"),a.a.createElement("span",null,"\uff0c\u63cf\u8ff0\u5982\u4e0b\uff1a")),a.a.createElement("div",{className:"title-right"},X.b.getBeautyTime(p))),a.a.createElement("div",{className:"".concat(this.state.isEditing?"isEditing":""," ").concat(y?"":"disabled"," ").concat(r.description?"":"no-description"," mr-des-content")},this.renderDesc()))),_>5?a.a.createElement("div",{className:"log-item more",onClick:function e(){t.setState({isMoreData:!t.state.isMoreData})}},a.a.createElement("div",{className:"log-item-left  no-mt"},a.a.createElement("div",{className:"log-item-icon"},a.a.createElement(m.a,{type:"more"}),a.a.createElement("div",{className:"log-line"}))),a.a.createElement("div",{className:"log-item-right"},a.a.createElement("div",{className:"log-item-title has-pb"},this.state.isMoreData?"\u9690\u85cf\u8f83\u65e9\u7684\u52a8\u6001":"\u663e\u793a\u8f83\u65e9\u7684 ".concat(_-5," \u6761\u52a8\u6001")))):null,a.a.createElement("div",null,this.state.isMoreData?a.a.createElement($e.default,{pagination:{onLoadMore:function e(n){t.props.getSummaryLogs(n)},hasMore:!1,useWindow:!1,getScrollParent:function e(){return document.querySelector("#container")}}},E.map((function(e){return a.a.createElement(kn,xn({log:e},t.props))}))):a.a.createElement("div",null,E.slice(-5).map((function(e){return a.a.createElement(kn,xn({log:e},t.props))})))),a.a.createElement("div",{className:"comment-input-md total-comment"},a.a.createElement("div",null,a.a.createElement(me.a,{image:w.avatar,text:w.nickname,size:"small"})),a.a.createElement("div",{className:"input-area"},this.state.isEditorShow?this.renderMd(!0):a.a.createElement("div",{className:"placeholder-text"},a.a.createElement(u.Input,{placeholder:"\u5c55\u5f00\u8bb2\u8bb2\u4f60\u7684\u770b\u6cd5",onClick:function e(){t.setState({isEditorShow:!0})},disabled:!b,style:{width:"100%"}}))))))}}]),n}(r.Component),Yn=n(26);function $n(e){return($n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function e(t){return typeof t}:function e(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function er(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?er(Object(n),!0).forEach((function(t){nr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):er(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function nr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rr(){return(rr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ar(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function or(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function cr(e,t,n){return t&&or(e.prototype,t),n&&or(e,n),e}function ir(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lr(e,t)}function lr(e,t){return(lr=Object.setPrototypeOf||function e(t,n){return t.__proto__=n,t})(e,t)}function sr(e){var t=fr();return function n(){var r=pr(e),a;if(t){var o=pr(this).constructor;a=Reflect.construct(r,arguments,o)}else a=r.apply(this,arguments);return ur(this,a)}}function ur(e,t){return!t||"object"!==$n(t)&&"function"!=typeof t?mr(e):t}function mr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fr(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function pr(e){return(pr=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)})(e)}var dr=function(e){ir(n,e);var t=sr(n);function n(){return ar(this,n),t.apply(this,arguments)}return cr(n,[{key:"componentDidMount",value:function e(){this.props.changeMrTabKey&&this.props.changeMrTabKey("/");var t=this.props.codeReviewDetail;Object(s.d)("Repo-MR",{sendPerf:!1,mr_id:t.id})}},{key:"render",value:function e(){var t=this.props,n=t.codeReviewDetail,r=t.sourceBranchExist,o=t.targetBranchExist,c=t.projectInfo,i=n.state;return a.a.createElement("div",{className:"mr-overview-wrapper"},a.a.createElement("div",{className:"mr-overview-left"},"false"!==r&&"false"!==o&&"closed"!==i&&"merged"!==i&&a.a.createElement(a.a.Fragment,null,a.a.createElement(ae,this.props)),a.a.createElement(Qn,rr({},this.props,{projectInfo:c}))),a.a.createElement("div",{className:"mr-overview-right"},a.a.createElement(Ve,this.props)))}}]),n}(r.Component),hr=Object(o.connect)((function(e){var t=e.project.projectMergeRequestDetail,n=t.root,r=t.overviewReducer,a=t.changesReducer;return tr(tr(tr({},n),r),{},{changesReducer:a,projectInfo:e.project.root.projectInfo})}),(function(e){return Object(c.bindActionCreators)(tr(tr({},i),{},{modifyCr:l.modifyCr,getSummaryLogs:l.getSummaryLogs,getBuilds:l.getBuilds,changeMrTabKey:l.changeMrTabKey,getMergeRequest:l.getMergeRequest,postDrafts:Yn.postDrafts,postInlineComments:Yn.postInlineComments,toggleComment:Yn.toggleComment}),e)}))(dr),gr=n(1656),yr=t.default=hr}}]);